<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>FluentdのデータをGraphiteに出力するときのTips - aptheia.info</title><link rel="alternate" type="application/rss+xml" title="apatheia.info" href="/atom.xml"/><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/91982df2178a1f22d41d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/91982df2178a1f22d41d.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-1a8a258926ecde76681b.js" defer=""></script><script src="/_next/static/chunks/framework-895f067827ebe11ffe45.js" defer=""></script><script src="/_next/static/chunks/main-a9acf05574b3448968f1.js" defer=""></script><script src="/_next/static/chunks/pages/_app-e9aa21e07402b3aa54f7.js" defer=""></script><script src="/_next/static/chunks/915-c287d7adb8a31cf4da35.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-c134caf83809c687960e.js" defer=""></script><script src="/_next/static/WgvNWvBzFcl59j028-pFu/_buildManifest.js" defer=""></script><script src="/_next/static/WgvNWvBzFcl59j028-pFu/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header><div id="site-title"><h1><a href="/">apatheia.info</a></h1></div><nav><ul><li><a href="/">Home</a></li><li><a href="/atom.xml">RSS</a></li></ul></nav></header><main><article><h1>FluentdのデータをGraphiteに出力するときのTips</h1><p id="article-info">Published on <!-- -->2013.03.17<!-- --> <span><a href="/blog/categories/fluentd/">fluentd</a> </span><span><a href="/blog/categories/graphite/">graphite</a> </span><span><a href="/blog/categories/logging/">logging</a> </span><span><a href="/blog/categories/visualization/">visualization</a> </span></p><div><p><a href="https://github.com/hotchpotch/fluent-plugin-graphite">fluent-plugin-graphite</a> 利用時のメモ。</p>
<p>Ops界隈での可視化というと、ここ何年かは<a href="http://graphite.wikidot.com/">Graphite</a>でグラフを作ってそれを他のツールで表示する、みたいなのが多い。<a href="http://fluentd.org/">Fluentd</a>のデータを可視化したい場合は<a href="http://kazeburo.github.com/GrowthForecast/">GrowthForecast</a>が使われることが多いけど、<a href="http://graphite.wikidot.com/">Graphite</a>使ってみるといろんなツールと組み合わせられておもしろい。</p>
<!-- more -->
<p>Fluentd から Graphite へデータを送るのは <a href="https://github.com/hotchpotch/fluent-plugin-graphite">Fluent-plugin-graphite</a> を使えば簡単に実現できそうなんだけど、プラグイン側のインターフェース(<code>:key</code> や <code>:count</code> といったキーが必要)に合わせて入力のデータを整形する必要がある。</p>
<p>こういった調整は、out_map を使うことで実現できる。</p>
<pre><code>&#x3C;source>
  type tail
  format apache
  path /var/log/httpd/access_log
  tag apache.access
&#x3C;/source>
&#x3C;match apache.access>
  type map
  map [["graphite." + tag, time, {"key" => "graphite.apache.accesslog.code." + record["code"], "count" => 1}]]
  multi true
&#x3C;/match>
&#x3C;match graphite.**>
  type graphite
&#x3C;/match>
</code></pre>
</div></article></main><footer><ul><li>Link:</li><li><a href="https://twitter.com/f440">Twitter</a></li><li><a href="https://github.com/f440">Github</a></li><li><a href="https://pinbaord.in/u:f440">Pinbaord</a></li></ul></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"localPath":"/home/f440/go/src/github.com/f440/f440.github.com/content/2013-03-17-fluentd-and-graphite.markdown","path":"2013/03/17/fluentd-and-graphite","layout":"post","title":"FluentdのデータをGraphiteに出力するときのTips","createdAt":"2013-03-17T06:50:00.000Z","kind":"article","comments":true,"tags":["fluentd","graphite","logging","visualization"],"content":"\u003cp\u003e\u003ca href=\"https://github.com/hotchpotch/fluent-plugin-graphite\"\u003efluent-plugin-graphite\u003c/a\u003e 利用時のメモ。\u003c/p\u003e\n\u003cp\u003eOps界隈での可視化というと、ここ何年かは\u003ca href=\"http://graphite.wikidot.com/\"\u003eGraphite\u003c/a\u003eでグラフを作ってそれを他のツールで表示する、みたいなのが多い。\u003ca href=\"http://fluentd.org/\"\u003eFluentd\u003c/a\u003eのデータを可視化したい場合は\u003ca href=\"http://kazeburo.github.com/GrowthForecast/\"\u003eGrowthForecast\u003c/a\u003eが使われることが多いけど、\u003ca href=\"http://graphite.wikidot.com/\"\u003eGraphite\u003c/a\u003e使ってみるといろんなツールと組み合わせられておもしろい。\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003cp\u003eFluentd から Graphite へデータを送るのは \u003ca href=\"https://github.com/hotchpotch/fluent-plugin-graphite\"\u003eFluent-plugin-graphite\u003c/a\u003e を使えば簡単に実現できそうなんだけど、プラグイン側のインターフェース(\u003ccode\u003e:key\u003c/code\u003e や \u003ccode\u003e:count\u003c/code\u003e といったキーが必要)に合わせて入力のデータを整形する必要がある。\u003c/p\u003e\n\u003cp\u003eこういった調整は、out_map を使うことで実現できる。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\u0026#x3C;source\u003e\n  type tail\n  format apache\n  path /var/log/httpd/access_log\n  tag apache.access\n\u0026#x3C;/source\u003e\n\u0026#x3C;match apache.access\u003e\n  type map\n  map [[\"graphite.\" + tag, time, {\"key\" =\u003e \"graphite.apache.accesslog.code.\" + record[\"code\"], \"count\" =\u003e 1}]]\n  multi true\n\u0026#x3C;/match\u003e\n\u0026#x3C;match graphite.**\u003e\n  type graphite\n\u0026#x3C;/match\u003e\n\u003c/code\u003e\u003c/pre\u003e\n"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["2013","03","17","fluentd-and-graphite"]},"buildId":"WgvNWvBzFcl59j028-pFu","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>