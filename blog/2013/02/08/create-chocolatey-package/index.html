<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>chocolatey で Haskell Platform 用のパッケージを作る - aptheia.info</title><link rel="alternate" type="application/rss+xml" title="apatheia.info" href="/atom.xml"/><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/3c128f59c2ecef969dbc.css" as="style"/><link rel="stylesheet" href="/_next/static/css/3c128f59c2ecef969dbc.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-1a8a258926ecde76681b.js" defer=""></script><script src="/_next/static/chunks/framework-895f067827ebe11ffe45.js" defer=""></script><script src="/_next/static/chunks/main-a9acf05574b3448968f1.js" defer=""></script><script src="/_next/static/chunks/pages/_app-d96712b144c157b4cbfa.js" defer=""></script><script src="/_next/static/chunks/915-c287d7adb8a31cf4da35.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-c134caf83809c687960e.js" defer=""></script><script src="/_next/static/DRRa5gyB7gBKf8n1UmP3L/_buildManifest.js" defer=""></script><script src="/_next/static/DRRa5gyB7gBKf8n1UmP3L/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header><div id="site-title"><h1><a href="/">apatheia.info</a></h1></div><nav><ul><li><a href="/">Home</a></li><li><a href="/atom.xml">RSS</a></li></ul></nav></header><main><article><h1>chocolatey で Haskell Platform 用のパッケージを作る</h1><p id="article-info">Published on <!-- -->2013.02.08<!-- --> <span><a href="/blog/categories/windows/">windows</a> </span><span><a href="/blog/categories/chocolatey/">chocolatey</a> </span><span><a href="/blog/categories/haskell/">haskell</a> </span><span><a href="/blog/categories/chef/">chef</a> </span></p><div><p><a href="http://chocolatey.org/">chocolatey</a> の仕組みに興味を持ったので、パッケージを作ってみる。</p>
<!-- more -->
<p>目標は「<a href="http://www.haskell.org/platform/windows.html">Haskell Platform for Windows</a> からインストーラをダウンロードしてきてサイレントインストール」ができるパッケージを作って、<a href="http://chocolatey.org/">chocolatey</a> のリポジトリにパッケージを登録してみる。</p>
<h2>作業</h2>
<h3>パッケージ作成</h3>
<p><a href="https://github.com/chocolatey/chocolatey/wiki/CreatePackages">ドキュメント</a>では <a href="https://github.com/chucknorris/Warmup">warmup</a> (プロジェクトのひな形を作ったり、そこで生成されたファイル内の文字列を置換したりするプログラム) を使ったやり方が説明されているけど、うまく動かなかったのでガリガリ手作業でやっていく。</p>
<p>前提として、chocolatey のインストール方法は済んでいるものとする。</p>
<p>まずはテンプレートを手に入れる。github から直接ファイルをダウンロードでもいいけど、今回の手順では clone してみよう。</p>
<pre><code># git 入れてなければ インストール
cinst git
# パスを通すため、コマンドプロンプトから抜けて新しく立ち上げ直す

cd %ChocolateyInstall%
git clone https://github.com/chocolatey/chocolateytemplates.git
cd chocolateytemplates\_templates
</code></pre>
<p>どこでもいいので、作業用にフォルダを作ってそこにテンプレートをコピーする。</p>
<pre><code>cd %USERPROFILE%
mkdir my_templates
cd my_templates
xcopy %ChocolateyInstall%\chocolateytemplates\_templates\chocolatey HaskellPlatform /s /e /i
</code></pre>
<p>いよいよテンプレートの中身を作っていく。</p>
<pre><code>cd HaskellPlatform
ren __NAME__.nuspec HaskellPlatform.nuspec 
# HaskellPlatform.nuspec と tools/chocolateyInstall.ps1 を開いてプレースホルダを変更
notepad HaskellPlatform.nuspec
notepad tools/chocolateyInstall.ps1
# HaskellPlatform は NSIS 製なので、
# http://nsis.sourceforge.net/Docs/Chapter3.html#3.2 より、
# サイレントインストールのためのコマンドラインオプションが /S をつければいい
</code></pre>
<p>編集後のファイルは以下の通り</p>
<ul>
<li><a href="https://github.com/f440/chocolatey-HaskellPlatform/blob/master/HaskellPlatform.nuspec">HaskellPlatform.nuspec</a></li>
<li><a href="https://github.com/f440/chocolatey-HaskellPlatform/blob/master/tools/chocolateyInstall.ps1">tools/chocolatey-HaskellPlatform.ps1</a></li>
</ul>
<p>パッケージングする。</p>
<pre><code>cpack
</code></pre>
<p>HaskellPlatform.{バージョン番号}.nupkg ができるはず。インストールしてみよう。</p>
<pre><code>cinst HaskellPlatform -source %cd%
</code></pre>
<p>うまくいけば、Haskell のサイレントインストールが始まる。</p>
<h3>パッケージ登録</h3>
<p><a href="http://chocolatey.org/">chocolatey</a> にパッケージを登録してみよう。パッケージの登録にはアカウントが必要。</p>
<p>登録方法は 2 種類。</p>
<ol>
<li>アップロードフォームから *.nupkg をアップロード</li>
<li>API キーを取得して、コマンドラインから push</li>
</ol>
<p>1 は簡単すぎるので、2 を試す。事前に <a href="http://chocolatey.org/">chocolatey</a> のアカウント画面から API キーを取得しておこう。</p>
<pre><code>cinst nuget.commandline
NuGet SetApiKey &#x3C;your key here> -source http://chocolatey.org/
cpush HaskellPlatform.{バージョン番号}.nupkg
</code></pre>
<p>登録が終われば、他のマシンから <code>cinst HaskellPlatform</code> でインストールできるようになる。</p>
<h2>まとめ</h2>
<p>アンインストールの設定が用意されていない、といっただいぶ手抜きなものだけど簡単にできた。</p>
<p><a href="http://chocolatey.org/">chocolatey</a> 公式の github アカウントでは <a href="https://github.com/chocolatey/chocolatey-cookbook">Chef 用の cookbook</a> を配布している。chef を使って Windows マシンをセットアップするとなると、パッケージマネージャがなければ <a href="https://github.com/opscode-cookbooks/windows">chef-cookbooks/windows</a> (Windows向けのResource/Provider) を使ってインストール方法をちまちま指定していくことになるわけだけど、<a href="http://chocolatey.org/">chocolatey</a> 使えば処理が抽象化できてよさげ。</p>
<h2>参考</h2>
<ul>
<li><a href="http://chocolatey.org/">chocolatey</a></li>
<li><a href="http://www.haskell.org/platform/windows.html">Haskell Platform for Windows</a></li>
<li><a href="https://github.com/chocolatey/">chocolateyのgithubアカウント</a></li>
</ul>
</div></article></main><footer><ul><li>Link:</li><li><a href="https://twitter.com/f440">Twitter</a></li><li><a href="https://github.com/f440">Github</a></li><li><a href="https://pinbaord.in/u:f440">Pinbaord</a></li></ul></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"localPath":"/home/f440/go/src/github.com/f440/f440.github.com/content/2013-02-08-create-chocolatey-package.markdown","path":"2013/02/08/create-chocolatey-package","layout":"post","title":"chocolatey で Haskell Platform 用のパッケージを作る","createdAt":"2013-02-08T13:49:00.000Z","kind":"article","comments":true,"tags":["windows","chocolatey","haskell","chef"],"content":"\u003cp\u003e\u003ca href=\"http://chocolatey.org/\"\u003echocolatey\u003c/a\u003e の仕組みに興味を持ったので、パッケージを作ってみる。\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003cp\u003e目標は「\u003ca href=\"http://www.haskell.org/platform/windows.html\"\u003eHaskell Platform for Windows\u003c/a\u003e からインストーラをダウンロードしてきてサイレントインストール」ができるパッケージを作って、\u003ca href=\"http://chocolatey.org/\"\u003echocolatey\u003c/a\u003e のリポジトリにパッケージを登録してみる。\u003c/p\u003e\n\u003ch2\u003e作業\u003c/h2\u003e\n\u003ch3\u003eパッケージ作成\u003c/h3\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/chocolatey/chocolatey/wiki/CreatePackages\"\u003eドキュメント\u003c/a\u003eでは \u003ca href=\"https://github.com/chucknorris/Warmup\"\u003ewarmup\u003c/a\u003e (プロジェクトのひな形を作ったり、そこで生成されたファイル内の文字列を置換したりするプログラム) を使ったやり方が説明されているけど、うまく動かなかったのでガリガリ手作業でやっていく。\u003c/p\u003e\n\u003cp\u003e前提として、chocolatey のインストール方法は済んでいるものとする。\u003c/p\u003e\n\u003cp\u003eまずはテンプレートを手に入れる。github から直接ファイルをダウンロードでもいいけど、今回の手順では clone してみよう。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# git 入れてなければ インストール\ncinst git\n# パスを通すため、コマンドプロンプトから抜けて新しく立ち上げ直す\n\ncd %ChocolateyInstall%\ngit clone https://github.com/chocolatey/chocolateytemplates.git\ncd chocolateytemplates\\_templates\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eどこでもいいので、作業用にフォルダを作ってそこにテンプレートをコピーする。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ecd %USERPROFILE%\nmkdir my_templates\ncd my_templates\nxcopy %ChocolateyInstall%\\chocolateytemplates\\_templates\\chocolatey HaskellPlatform /s /e /i\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eいよいよテンプレートの中身を作っていく。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ecd HaskellPlatform\nren __NAME__.nuspec HaskellPlatform.nuspec \n# HaskellPlatform.nuspec と tools/chocolateyInstall.ps1 を開いてプレースホルダを変更\nnotepad HaskellPlatform.nuspec\nnotepad tools/chocolateyInstall.ps1\n# HaskellPlatform は NSIS 製なので、\n# http://nsis.sourceforge.net/Docs/Chapter3.html#3.2 より、\n# サイレントインストールのためのコマンドラインオプションが /S をつければいい\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e編集後のファイルは以下の通り\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/f440/chocolatey-HaskellPlatform/blob/master/HaskellPlatform.nuspec\"\u003eHaskellPlatform.nuspec\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/f440/chocolatey-HaskellPlatform/blob/master/tools/chocolateyInstall.ps1\"\u003etools/chocolatey-HaskellPlatform.ps1\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eパッケージングする。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ecpack\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eHaskellPlatform.{バージョン番号}.nupkg ができるはず。インストールしてみよう。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ecinst HaskellPlatform -source %cd%\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eうまくいけば、Haskell のサイレントインストールが始まる。\u003c/p\u003e\n\u003ch3\u003eパッケージ登録\u003c/h3\u003e\n\u003cp\u003e\u003ca href=\"http://chocolatey.org/\"\u003echocolatey\u003c/a\u003e にパッケージを登録してみよう。パッケージの登録にはアカウントが必要。\u003c/p\u003e\n\u003cp\u003e登録方法は 2 種類。\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eアップロードフォームから *.nupkg をアップロード\u003c/li\u003e\n\u003cli\u003eAPI キーを取得して、コマンドラインから push\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e1 は簡単すぎるので、2 を試す。事前に \u003ca href=\"http://chocolatey.org/\"\u003echocolatey\u003c/a\u003e のアカウント画面から API キーを取得しておこう。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ecinst nuget.commandline\nNuGet SetApiKey \u0026#x3C;your key here\u003e -source http://chocolatey.org/\ncpush HaskellPlatform.{バージョン番号}.nupkg\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e登録が終われば、他のマシンから \u003ccode\u003ecinst HaskellPlatform\u003c/code\u003e でインストールできるようになる。\u003c/p\u003e\n\u003ch2\u003eまとめ\u003c/h2\u003e\n\u003cp\u003eアンインストールの設定が用意されていない、といっただいぶ手抜きなものだけど簡単にできた。\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://chocolatey.org/\"\u003echocolatey\u003c/a\u003e 公式の github アカウントでは \u003ca href=\"https://github.com/chocolatey/chocolatey-cookbook\"\u003eChef 用の cookbook\u003c/a\u003e を配布している。chef を使って Windows マシンをセットアップするとなると、パッケージマネージャがなければ \u003ca href=\"https://github.com/opscode-cookbooks/windows\"\u003echef-cookbooks/windows\u003c/a\u003e (Windows向けのResource/Provider) を使ってインストール方法をちまちま指定していくことになるわけだけど、\u003ca href=\"http://chocolatey.org/\"\u003echocolatey\u003c/a\u003e 使えば処理が抽象化できてよさげ。\u003c/p\u003e\n\u003ch2\u003e参考\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://chocolatey.org/\"\u003echocolatey\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.haskell.org/platform/windows.html\"\u003eHaskell Platform for Windows\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/chocolatey/\"\u003echocolateyのgithubアカウント\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["2013","02","08","create-chocolatey-package"]},"buildId":"DRRa5gyB7gBKf8n1UmP3L","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>