<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>fpm で Mesos の RPM を作るまで - aptheia.info</title><link rel="alternate" type="application/rss+xml" title="apatheia.info" href="/atom.xml"/><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/91982df2178a1f22d41d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/91982df2178a1f22d41d.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-1a8a258926ecde76681b.js" defer=""></script><script src="/_next/static/chunks/framework-895f067827ebe11ffe45.js" defer=""></script><script src="/_next/static/chunks/main-a9acf05574b3448968f1.js" defer=""></script><script src="/_next/static/chunks/pages/_app-e9aa21e07402b3aa54f7.js" defer=""></script><script src="/_next/static/chunks/915-c287d7adb8a31cf4da35.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-c134caf83809c687960e.js" defer=""></script><script src="/_next/static/WgvNWvBzFcl59j028-pFu/_buildManifest.js" defer=""></script><script src="/_next/static/WgvNWvBzFcl59j028-pFu/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header><div id="site-title"><h1><a href="/">apatheia.info</a></h1></div><nav><ul><li><a href="/">Home</a></li><li><a href="/atom.xml">RSS</a></li></ul></nav></header><main><article><h1>fpm で Mesos の RPM を作るまで</h1><p id="article-info">Published on <!-- -->2013.05.03<!-- --> <span><a href="/blog/categories/packaging/">packaging</a> </span><span><a href="/blog/categories/mesos/">mesos</a> </span></p><div><p><a href="http://incubator.apache.org/mesos/">Mesos</a> をインストールするとき各マシンでビルドはしんどいので、<a href="https://github.com/jordansissel/fpm">fpm</a> で Mesos の RPM を作ってインストールしている。ビルドからパッケージ作成までの作業ログを残しておく。</p>
<!-- more -->
<ul>
<li><a href="https://github.com/jordansissel/fpm">fpm</a> は Ruby の gem や Node.js の npm などのプログラミング言語のライブラリ、あるいは直接ディレクトリから RPM やら Deb やらのパッケージを作成するソフトウェア。</li>
<li><a href="http://incubator.apache.org/mesos/">Mesos</a> はクラスタ構成のリソースをよしなに管理するソフトウェア。
<ul>
<li>今回の話では具体的な使い方までは触れない</li>
</ul>
</li>
</ul>
<h2>手順</h2>
<p>作業環境は CentOS 6.4 x86_64。</p>
<p>Ruby をインストール。</p>
<pre><code>sudo yum install ruby.x86_64 rubygems ruby-devel.x86_64 rpm-build.x86_64
</code></pre>
<p>fpm をインストール。</p>
<pre><code>sudo gem install fpm --no-rdoc --no-ri
</code></pre>
<p>Mesos のソースをダウンロード、展開。</p>
<pre><code>curl -LO http://ftp.meisei-u.ac.jp/mirror/apache/dist/incubator/mesos/mesos-0.10.0-incubating/mesos-0.10.0-incubating.tar.gz
tar xf mesos-0.10.0-incubating.tar.gz
cd mesos-0.10.0
</code></pre>
<p>Mesos のビルドに必要なパッケージをインストール。</p>
<pre><code>sudo yum install gcc-c++.x86_64 patch.x86_64 python-devel.x86_64 \
  cppunit-devel.x86_64 java-1.6.0-openjdk-devel.x86_64
</code></pre>
<p>ビルド。今回は、configure のオプションで Redhat っぽい配置を指定している。<code>/opt/mesos</code> とか <code>/usr/local/mesos</code> に全部まとめたければ --prefix を使うなど、このあたりはお好みで。
<code>make install</code> 時には書き込み可能な場所を DESTDIR で指定。説明中では、<code>/tmp/mesos</code> を利用している。</p>
<pre><code>JAVA_HOME=/etc/alternatives/java_sdk ./configure \
  --bindir=/usr/bin --sbindir=/usr/sbin --libexecdir=/usr/libexec \
  --localstatedir=/var --libdir=/usr/lib64 --includedir=/usr/include \
  --datarootdir=/usr/share
make
make install DESTDIR=/tmp/mesos
</code></pre>
<p>fpm でパッケージを作成。詳細は fpm --help を参照。注意点としては、<code>--description</code> は RPM のメタ情報 <code>description</code>, <code>summary</code> で兼用されるので、あまり長い情報を入れると <code>yum search</code> とかがごちゃごちゃすることになる。適度に切り詰めた方がいい。</p>
<pre><code>fpm -s dir -t rpm \
  -v 0.10.0 \
  -n mesos \
  -C /tmp/mesos \
  -a x86_64 \
  --license "ASL 2.0" \
  --url "http://incubator.apache.org/mesos/" \
  --description "Dynamic resource sharing for clusters" \
  -d python-devel \
  -d java-1.6.0-openjdk-devel \
  .
</code></pre>
<p>RPM ファイルのメタ情報やファイル一覧をチェック。</p>
<pre><code>rpm -qpi mesos-0.10.0-1.x86_64.rpm
rpm -qpl mesos-0.10.0-1.x86_64.rpm
</code></pre>
<p>あとは、できあがった RPM ファイルを他のマシンに持っていってインストール。</p>
<pre><code>sudo yum install ./mesos-0.10.0-1.x86_64.rpm
</code></pre>
</div></article></main><footer><ul><li>Link:</li><li><a href="https://twitter.com/f440">Twitter</a></li><li><a href="https://github.com/f440">Github</a></li><li><a href="https://pinbaord.in/u:f440">Pinbaord</a></li></ul></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"localPath":"/home/f440/go/src/github.com/f440/f440.github.com/content/2013-05-03-create-mesos-rpm-using-fpm.markdown","path":"2013/05/03/create-mesos-rpm-using-fpm","layout":"post","title":"fpm で Mesos の RPM を作るまで","createdAt":"2013-05-03T08:24:00.000Z","kind":"article","comments":true,"tags":["packaging","mesos"],"content":"\u003cp\u003e\u003ca href=\"http://incubator.apache.org/mesos/\"\u003eMesos\u003c/a\u003e をインストールするとき各マシンでビルドはしんどいので、\u003ca href=\"https://github.com/jordansissel/fpm\"\u003efpm\u003c/a\u003e で Mesos の RPM を作ってインストールしている。ビルドからパッケージ作成までの作業ログを残しておく。\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/jordansissel/fpm\"\u003efpm\u003c/a\u003e は Ruby の gem や Node.js の npm などのプログラミング言語のライブラリ、あるいは直接ディレクトリから RPM やら Deb やらのパッケージを作成するソフトウェア。\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://incubator.apache.org/mesos/\"\u003eMesos\u003c/a\u003e はクラスタ構成のリソースをよしなに管理するソフトウェア。\n\u003cul\u003e\n\u003cli\u003e今回の話では具体的な使い方までは触れない\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e手順\u003c/h2\u003e\n\u003cp\u003e作業環境は CentOS 6.4 x86_64。\u003c/p\u003e\n\u003cp\u003eRuby をインストール。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003esudo yum install ruby.x86_64 rubygems ruby-devel.x86_64 rpm-build.x86_64\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003efpm をインストール。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003esudo gem install fpm --no-rdoc --no-ri\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eMesos のソースをダウンロード、展開。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ecurl -LO http://ftp.meisei-u.ac.jp/mirror/apache/dist/incubator/mesos/mesos-0.10.0-incubating/mesos-0.10.0-incubating.tar.gz\ntar xf mesos-0.10.0-incubating.tar.gz\ncd mesos-0.10.0\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eMesos のビルドに必要なパッケージをインストール。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003esudo yum install gcc-c++.x86_64 patch.x86_64 python-devel.x86_64 \\\n  cppunit-devel.x86_64 java-1.6.0-openjdk-devel.x86_64\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eビルド。今回は、configure のオプションで Redhat っぽい配置を指定している。\u003ccode\u003e/opt/mesos\u003c/code\u003e とか \u003ccode\u003e/usr/local/mesos\u003c/code\u003e に全部まとめたければ --prefix を使うなど、このあたりはお好みで。\n\u003ccode\u003emake install\u003c/code\u003e 時には書き込み可能な場所を DESTDIR で指定。説明中では、\u003ccode\u003e/tmp/mesos\u003c/code\u003e を利用している。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003eJAVA_HOME=/etc/alternatives/java_sdk ./configure \\\n  --bindir=/usr/bin --sbindir=/usr/sbin --libexecdir=/usr/libexec \\\n  --localstatedir=/var --libdir=/usr/lib64 --includedir=/usr/include \\\n  --datarootdir=/usr/share\nmake\nmake install DESTDIR=/tmp/mesos\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003efpm でパッケージを作成。詳細は fpm --help を参照。注意点としては、\u003ccode\u003e--description\u003c/code\u003e は RPM のメタ情報 \u003ccode\u003edescription\u003c/code\u003e, \u003ccode\u003esummary\u003c/code\u003e で兼用されるので、あまり長い情報を入れると \u003ccode\u003eyum search\u003c/code\u003e とかがごちゃごちゃすることになる。適度に切り詰めた方がいい。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003efpm -s dir -t rpm \\\n  -v 0.10.0 \\\n  -n mesos \\\n  -C /tmp/mesos \\\n  -a x86_64 \\\n  --license \"ASL 2.0\" \\\n  --url \"http://incubator.apache.org/mesos/\" \\\n  --description \"Dynamic resource sharing for clusters\" \\\n  -d python-devel \\\n  -d java-1.6.0-openjdk-devel \\\n  .\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eRPM ファイルのメタ情報やファイル一覧をチェック。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003erpm -qpi mesos-0.10.0-1.x86_64.rpm\nrpm -qpl mesos-0.10.0-1.x86_64.rpm\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eあとは、できあがった RPM ファイルを他のマシンに持っていってインストール。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003esudo yum install ./mesos-0.10.0-1.x86_64.rpm\n\u003c/code\u003e\u003c/pre\u003e\n"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["2013","05","03","create-mesos-rpm-using-fpm"]},"buildId":"WgvNWvBzFcl59j028-pFu","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>