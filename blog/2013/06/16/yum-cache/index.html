<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>yum のパッケージキャッシュについて - aptheia.info</title><link rel="alternate" type="application/rss+xml" title="apatheia.info" href="/atom.xml"/><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/91982df2178a1f22d41d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/91982df2178a1f22d41d.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-1a8a258926ecde76681b.js" defer=""></script><script src="/_next/static/chunks/framework-895f067827ebe11ffe45.js" defer=""></script><script src="/_next/static/chunks/main-a9acf05574b3448968f1.js" defer=""></script><script src="/_next/static/chunks/pages/_app-e9aa21e07402b3aa54f7.js" defer=""></script><script src="/_next/static/chunks/915-c287d7adb8a31cf4da35.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-c134caf83809c687960e.js" defer=""></script><script src="/_next/static/WgvNWvBzFcl59j028-pFu/_buildManifest.js" defer=""></script><script src="/_next/static/WgvNWvBzFcl59j028-pFu/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header><div id="site-title"><h1><a href="/">apatheia.info</a></h1></div><nav><ul><li><a href="/">Home</a></li><li><a href="/atom.xml">RSS</a></li></ul></nav></header><main><article><h1>yum のパッケージキャッシュについて</h1><p id="article-info">Published on <!-- -->2013.06.16<!-- --> <span><a href="/blog/categories/yum/">yum</a> </span></p><div><p><code>/etc/yum.conf</code>で<code>keepcache=1</code>にしておくと、インストールしたパッケージがキャッシュされるようになる。これが無効化された状態だと、パッケージアップグレード時に問題が起きても元に戻せなくなるので有効化しておいた方がいい。</p>
<!-- more -->
<p>あるパッケージについて、どのバージョンが利用可能な状態かは以下で確認できる。</p>
<pre><code>$ sudo yum --showduplicates list パッケージ名
</code></pre>
<p>RHEL なら過去のバージョンまですべて手に入るけど、CentOS だとOSリリース時のバージョンと最新版しか手に入らない模様。リポジトリ上なりキャッシュなりで過去のバージョンが手に入るのであれば、<code>yum install</code> や <code>yum update</code> は以下の手順でロールバックが行える。</p>
<pre><code># yum の利用履歴を確認
$ sudo yum history

# 履歴から詳細を確認
# 未引数なら直近、引数ありなら該当する ID を表示
$ sudo yum history info 4

# 仮に ID 4 で問題のバージョンアップが行われたようだということが確認できたら、その ID を指定して操作をアンドゥ
$ sudo yum history undo 4
</code></pre>
<p>アンドゥ(リドゥもある)では、対象パッケージおよび依存パッケージがまとめて一度に入れ替えられる。これはパッケージの操作がちゃんとトランザクションになっているため。</p>
<p>話がそれるけど、パッケージの操作にトランザクションがかかるというのはかなり重要だ。たとえば syslog-ng から rsyslog に入れ替えるとき、単純にアンインストール、インストールの順番でやろうとするとアンインストールのタイミングで大量の Syslog 依存なパッケージが道連れになるけど、以下のようにすればひとつのトランザクションでパッケージを入れ替えることができる。(情報源: <a href="http://wiki.rsyslog.com/index.php/Install_rsyslog_with_yum">Rsyslog Wiki</a>)</p>
<pre><code>$ sudo yum shell
> remove syslog-ng
> install rsyslog
> run
</code></pre>
<p>話がそれたついでにふれておくと、vagrant を使っているのであれば <a href="https://github.com/fgrehm/vagrant-cachier">vagrant-cachier</a> を使うとパッケージのキャッシュ保存先を仮想マシン外の領域(ホストOSとの共有ディスク部分など)に変更してくれる。こうすることで、仮想マシンを破棄してもパッケージのキャッシュが永続化されるため、2回目以降はダウンロードがスキップされて高速化する。</p>
<p>話を戻すと、世の中何が起きるかわからないので古いパッケージもとっておいたほうがいいかと。ディスク容量が気になりだしたら、<code>yum clean packages</code> を実行すればキャッシュは消せる。</p>
</div></article></main><footer><ul><li>Link:</li><li><a href="https://twitter.com/f440">Twitter</a></li><li><a href="https://github.com/f440">Github</a></li><li><a href="https://pinbaord.in/u:f440">Pinbaord</a></li></ul></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"localPath":"/home/f440/go/src/github.com/f440/f440.github.com/content/2013-06-16-yum-cache.markdown","path":"2013/06/16/yum-cache","layout":"post","title":"yum のパッケージキャッシュについて","createdAt":"2013-06-15T16:26:00.000Z","kind":"article","comments":true,"tags":["yum"],"content":"\u003cp\u003e\u003ccode\u003e/etc/yum.conf\u003c/code\u003eで\u003ccode\u003ekeepcache=1\u003c/code\u003eにしておくと、インストールしたパッケージがキャッシュされるようになる。これが無効化された状態だと、パッケージアップグレード時に問題が起きても元に戻せなくなるので有効化しておいた方がいい。\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003cp\u003eあるパッケージについて、どのバージョンが利用可能な状態かは以下で確認できる。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e$ sudo yum --showduplicates list パッケージ名\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eRHEL なら過去のバージョンまですべて手に入るけど、CentOS だとOSリリース時のバージョンと最新版しか手に入らない模様。リポジトリ上なりキャッシュなりで過去のバージョンが手に入るのであれば、\u003ccode\u003eyum install\u003c/code\u003e や \u003ccode\u003eyum update\u003c/code\u003e は以下の手順でロールバックが行える。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# yum の利用履歴を確認\n$ sudo yum history\n\n# 履歴から詳細を確認\n# 未引数なら直近、引数ありなら該当する ID を表示\n$ sudo yum history info 4\n\n# 仮に ID 4 で問題のバージョンアップが行われたようだということが確認できたら、その ID を指定して操作をアンドゥ\n$ sudo yum history undo 4\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eアンドゥ(リドゥもある)では、対象パッケージおよび依存パッケージがまとめて一度に入れ替えられる。これはパッケージの操作がちゃんとトランザクションになっているため。\u003c/p\u003e\n\u003cp\u003e話がそれるけど、パッケージの操作にトランザクションがかかるというのはかなり重要だ。たとえば syslog-ng から rsyslog に入れ替えるとき、単純にアンインストール、インストールの順番でやろうとするとアンインストールのタイミングで大量の Syslog 依存なパッケージが道連れになるけど、以下のようにすればひとつのトランザクションでパッケージを入れ替えることができる。(情報源: \u003ca href=\"http://wiki.rsyslog.com/index.php/Install_rsyslog_with_yum\"\u003eRsyslog Wiki\u003c/a\u003e)\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e$ sudo yum shell\n\u003e remove syslog-ng\n\u003e install rsyslog\n\u003e run\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e話がそれたついでにふれておくと、vagrant を使っているのであれば \u003ca href=\"https://github.com/fgrehm/vagrant-cachier\"\u003evagrant-cachier\u003c/a\u003e を使うとパッケージのキャッシュ保存先を仮想マシン外の領域(ホストOSとの共有ディスク部分など)に変更してくれる。こうすることで、仮想マシンを破棄してもパッケージのキャッシュが永続化されるため、2回目以降はダウンロードがスキップされて高速化する。\u003c/p\u003e\n\u003cp\u003e話を戻すと、世の中何が起きるかわからないので古いパッケージもとっておいたほうがいいかと。ディスク容量が気になりだしたら、\u003ccode\u003eyum clean packages\u003c/code\u003e を実行すればキャッシュは消せる。\u003c/p\u003e\n"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["2013","06","16","yum-cache"]},"buildId":"WgvNWvBzFcl59j028-pFu","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>