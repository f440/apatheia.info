<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>イベント処理ツール riemannを使う - aptheia.info</title><link rel="alternate" type="application/rss+xml" title="apatheia.info" href="/atom.xml"/><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/3c128f59c2ecef969dbc.css" as="style"/><link rel="stylesheet" href="/_next/static/css/3c128f59c2ecef969dbc.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-1a8a258926ecde76681b.js" defer=""></script><script src="/_next/static/chunks/framework-895f067827ebe11ffe45.js" defer=""></script><script src="/_next/static/chunks/main-a9acf05574b3448968f1.js" defer=""></script><script src="/_next/static/chunks/pages/_app-d96712b144c157b4cbfa.js" defer=""></script><script src="/_next/static/chunks/915-c287d7adb8a31cf4da35.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5B...slug%5D-c134caf83809c687960e.js" defer=""></script><script src="/_next/static/DRRa5gyB7gBKf8n1UmP3L/_buildManifest.js" defer=""></script><script src="/_next/static/DRRa5gyB7gBKf8n1UmP3L/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header><div id="site-title"><h1><a href="/">apatheia.info</a></h1></div><nav><ul><li><a href="/">Home</a></li><li><a href="/atom.xml">RSS</a></li></ul></nav></header><main><article><h1>イベント処理ツール riemannを使う</h1><p id="article-info">Published on <!-- -->2012.09.22<!-- --> </p><div><p>イベント処理ツール <a href="http://aphyr.github.com/riemann/">riemann</a>を使ってみたのでその感想。</p>
<!-- more -->
<ul>
<li>サーバーは clojure で書かれている
<ul>
<li>設定ファイルは S 式</li>
</ul>
</li>
<li>クライアントは各言語版がある <a href="http://aphyr.github.com/riemann/clients.html">http://aphyr.github.com/riemann/clients.html</a></li>
<li>サーバーの状態は riemann-dash という sinatra でできた Web 画面から確認できる</li>
<li>クライアントからのメッセージはイベントと呼んでる
<ul>
<li>host, service, state, time, description, tags, metric, ttl というパラメータを持っている</li>
</ul>
</li>
<li>サーバー、クライアント間は Protocol Buffer で通信する</li>
</ul>
<p>公式サイトではサーバーの tar ball と deb パッケージを配布している。動かすためには、Java で実行するだけ。</p>
<pre><code>$ wget [http://aphyr.com/riemann/riemann-0.1.2.tar.bz2](http://aphyr.com/riemann/riemann-0.1.2.tar.bz2)
$ tar xf riemann-0.1.2.tar.bz2
$ cd riemann-0.1.2
$ bin/riemann etc/riemann.config
</code></pre>
<p>設定ファイルを S 式でがりがりかけるのはおもしろくって、riemann だとこんな感じに設定できる:</p>
<pre><code># 公式サイトの設定例から引用 [http://aphyr.github.com/riemann/configuring.html](http://aphyr.github.com/riemann/configuring.html)

; You can use any options for [https://github.com/drewr/postal.](https://github.com/drewr/postal.)
;
; (mailer {:from "riemann@trioptimum.com"
;          :host "mx1.trioptimum.com"
;          :user "foo"
;          :pass "bar"})

(streams
  (where (and (service "web server")
              (state "exception"))
         (tagged "controller"
                 (email "5551234567@txt.att.net"))
         (tagged "view"
                 (email "delacroix@trioptimum.com" "bronson@trioptimum.com"))
         (tagged "model"
                 (email "staff@vonbraun.mil"))))
</code></pre>
<p>「イベント x あるいは y が n 秒以内に m 回発生したらアラート」みたいなのも設定できるみたいなので、監視ツールと組み合わせてもおもしろそう。</p>
<p>ソフトウェアの内容や使いかっては、 <a href="http://fluentd.org/">fluentd</a>
ととても近いように感じた。それぞれ公式サイトに掲げられているメッセージを比較してみると、fluentd は「Fluentd is a lightweight and flexible log collector」で、riemann は「Riemann is an event stream processor」だった。fluentd はイベントを集計できる形式でログとして残すこと、riemannはイベントストリームから特定の状況をリアルタイムで見つけだすことが主眼ということかな。</p>
<h2>参考</h2>
<ul>
<li><a href="http://aphyr.github.com/riemann/">公式サイト</a></li>
<li><a href="http://vimeo.com/45807716">紹介ビデオ</a></li>
<li><a href="http://blog.boundary.com/2012/03/12/boundary-tech-talks-march-6th-2012/">紹介ビデオ</a></li>
<li><a href="https://twitter.com/aphyr">作者 Kyle Kingsbury</a></li>
<li><a href="http://labs.amara.org/2012-07-16-metrics.html">利用事例</a></li>
</ul>
<h3>関連するサービス、同類のソフトウェア</h3>
<ul>
<li><a href="http://fluentd.org/">fluentd</a></li>
<li><a href="http://boundary.com/">boundary</a></li>
<li><a href="http://aws.amazon.com/en/cloudwatch/">amazon cloudwatch</a></li>
<li><a href="http://www.loggly.com/">loggly</a></li>
<li>その他多くの監視ツール</li>
</ul>
</div></article></main><footer><ul><li>Link:</li><li><a href="https://twitter.com/f440">Twitter</a></li><li><a href="https://github.com/f440">Github</a></li><li><a href="https://pinbaord.in/u:f440">Pinbaord</a></li></ul></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"localPath":"/home/f440/go/src/github.com/f440/f440.github.com/content/2012-09-22-riemann.markdown","path":"2012/09/22/riemann","layout":"post","title":"イベント処理ツール riemannを使う","createdAt":"2012-09-22T09:00:00.000Z","kind":"article","comments":true,"tags":null,"content":"\u003cp\u003eイベント処理ツール \u003ca href=\"http://aphyr.github.com/riemann/\"\u003eriemann\u003c/a\u003eを使ってみたのでその感想。\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003cul\u003e\n\u003cli\u003eサーバーは clojure で書かれている\n\u003cul\u003e\n\u003cli\u003e設定ファイルは S 式\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eクライアントは各言語版がある \u003ca href=\"http://aphyr.github.com/riemann/clients.html\"\u003ehttp://aphyr.github.com/riemann/clients.html\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eサーバーの状態は riemann-dash という sinatra でできた Web 画面から確認できる\u003c/li\u003e\n\u003cli\u003eクライアントからのメッセージはイベントと呼んでる\n\u003cul\u003e\n\u003cli\u003ehost, service, state, time, description, tags, metric, ttl というパラメータを持っている\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eサーバー、クライアント間は Protocol Buffer で通信する\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e公式サイトではサーバーの tar ball と deb パッケージを配布している。動かすためには、Java で実行するだけ。\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e$ wget [http://aphyr.com/riemann/riemann-0.1.2.tar.bz2](http://aphyr.com/riemann/riemann-0.1.2.tar.bz2)\n$ tar xf riemann-0.1.2.tar.bz2\n$ cd riemann-0.1.2\n$ bin/riemann etc/riemann.config\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e設定ファイルを S 式でがりがりかけるのはおもしろくって、riemann だとこんな感じに設定できる:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e# 公式サイトの設定例から引用 [http://aphyr.github.com/riemann/configuring.html](http://aphyr.github.com/riemann/configuring.html)\n\n; You can use any options for [https://github.com/drewr/postal.](https://github.com/drewr/postal.)\n;\n; (mailer {:from \"riemann@trioptimum.com\"\n;          :host \"mx1.trioptimum.com\"\n;          :user \"foo\"\n;          :pass \"bar\"})\n\n(streams\n  (where (and (service \"web server\")\n              (state \"exception\"))\n         (tagged \"controller\"\n                 (email \"5551234567@txt.att.net\"))\n         (tagged \"view\"\n                 (email \"delacroix@trioptimum.com\" \"bronson@trioptimum.com\"))\n         (tagged \"model\"\n                 (email \"staff@vonbraun.mil\"))))\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e「イベント x あるいは y が n 秒以内に m 回発生したらアラート」みたいなのも設定できるみたいなので、監視ツールと組み合わせてもおもしろそう。\u003c/p\u003e\n\u003cp\u003eソフトウェアの内容や使いかっては、 \u003ca href=\"http://fluentd.org/\"\u003efluentd\u003c/a\u003e\nととても近いように感じた。それぞれ公式サイトに掲げられているメッセージを比較してみると、fluentd は「Fluentd is a lightweight and flexible log collector」で、riemann は「Riemann is an event stream processor」だった。fluentd はイベントを集計できる形式でログとして残すこと、riemannはイベントストリームから特定の状況をリアルタイムで見つけだすことが主眼ということかな。\u003c/p\u003e\n\u003ch2\u003e参考\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://aphyr.github.com/riemann/\"\u003e公式サイト\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://vimeo.com/45807716\"\u003e紹介ビデオ\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://blog.boundary.com/2012/03/12/boundary-tech-talks-march-6th-2012/\"\u003e紹介ビデオ\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://twitter.com/aphyr\"\u003e作者 Kyle Kingsbury\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://labs.amara.org/2012-07-16-metrics.html\"\u003e利用事例\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003e関連するサービス、同類のソフトウェア\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://fluentd.org/\"\u003efluentd\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://boundary.com/\"\u003eboundary\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://aws.amazon.com/en/cloudwatch/\"\u003eamazon cloudwatch\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.loggly.com/\"\u003eloggly\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eその他多くの監視ツール\u003c/li\u003e\n\u003c/ul\u003e\n"}},"__N_SSG":true},"page":"/blog/[...slug]","query":{"slug":["2012","09","22","riemann"]},"buildId":"DRRa5gyB7gBKf8n1UmP3L","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>