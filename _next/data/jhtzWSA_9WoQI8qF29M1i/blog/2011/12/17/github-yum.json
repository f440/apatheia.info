{"pageProps":{"post":{"localPath":"/home/f440/go/src/github.com/f440/f440.github.com/content/2011-12-17-github-yum.markdown","path":"2011/12/17/github-yum","layout":"post","title":"githubを使ってyumリポジトリを公開する","createdAt":"2011-12-16T15:00:00.000Z","kind":"article","comments":true,"tags":["git","github","centos","rpm","yum"],"content":"<p>ubuntuには<a href=\"https://launchpad.net/ubuntu/+ppas\">PPA</a>という仕組みがあり、プロジェクトホスティングサービス<a href=\"https://launchpad.net/\">launchpad</a> と連携してパッケージを簡単に配布する仕組みが用意されている。今回は、githubを使ってリポジトリにpushしたら自動的にRPMパッケージを公開する方法をまとめる。</p>\n<!-- more -->\n<p>※\nPPAだとサーバサイドで各種プラットフォームにビルドしてくれるが、そこまではサポートしない。あくまで配布だけ。RPMをどうやって作るのかについても触れない。</p>\n<p>以下は<a href=\"http://haproxy.1wt.eu/\">haproxy</a>\nを公開するときの例。haproxyのソースにはRPMのspecファイルが含まれているので、簡単にrpmが作成出来る。</p>\n<h2>手順</h2>\n<h3>git リポジトリを作成</h3>\n<p><a href=\"https://github.com/repositories/new\">Create a New Repository - github</a>\nからリポジトリを作成。</p>\n<h3>ディレクトリ構造を作成</h3>\n<p>以下はCentOS 5 64bit 版とソースRPMを配布する場合</p>\n<pre><code>$ mkdir -p haproxy-rpm/centos/5/os/{SRPMS,x86_64}\n$ cd haproxy-rpm\n</code></pre>\n<h3>ファイル設置</h3>\n<pre><code>$ cp /some/path/haproxy-1.4.18-1.src.rpm centos/5/os/SRPMS/\n$ cp /some/path/haproxy-1.4.18-1.x86_64.rpm centos/5/os/x86_64/\n</code></pre>\n<h3>メタデータ作成</h3>\n<pre><code>$ sudo yum install -y createrepo\n$ createrepo centos/5/os/SRPMS/\n$ createrepo centos/5/os/x86_64/\n</code></pre>\n<h3>commit &#x26; push</h3>\n<pre><code>$ git add .\n$ git ci -m initial commit  \n$ git remote add origin git@github.com:f440/haproxy-rpm.git\n$ git push -u origin master\n</code></pre>\n<h2>利用方法</h2>\n<p>/etc/yum.repos.d 以下にわかりやすい名前でファイルを作る。</p>\n<pre><code>サンプル /etc/yum.repos.d/haproxy-rpm-f440.repo (1行目やnameは適宜変更する)\n\n[haproxy-rpm-f440]\nname=haproxy-CentOS-$releasever\nbaseurl=https://raw.github.com/f440/haproxy-rpm/master/centos/5/os/x86_64/\nenabled=1\ngpgcheck=0\n</code></pre>\n<p>あとは通常通り <code>sudo yum install haproxy</code> でインストール可能。</p>\n<h2>備考</h2>\n<ul>\n<li>createrepo はdebian, ubuntuなどにもコマンドが用意されているので、ビルド以外の作業はRHEL系以外のOSでもよい</li>\n<li>mercurialを使いたければ、<a href=\"https://bitbucket.org\">bitbucket</a>でも似たような手順で公開可能。その際は baseurl の部分に <code>baseurl=https://bitbucket.org/f440/haproxy-rpm/raw/tip/centos/$releasever/os/$basearch/</code> のような形式で記述する</li>\n</ul>\n"}},"__N_SSG":true}