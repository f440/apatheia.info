{"pageProps":{"post":{"localPath":"/home/f440/go/src/github.com/f440/f440.github.com/content/2016-02-22-install-dlite.markdown","path":"2016/02/22/install-dlite","layout":"post","title":"DLiteでOS X上にDockerの環境を構築する","createdAt":"2016-02-22T11:54:00.000Z","updatedAt":"2016-05-08T10:12:00.000Z","kind":"article","comments":true,"tags":["docker"],"content":"<p><a href=\"https://github.com/nlf/dlite\">DLite</a> をインストールしたので、そのときのメモ。</p>\n<!-- more -->\n<h2>DLiteとは</h2>\n<p>OS XでDockerを使えるようにやつ。内部では<a href=\"https://github.com/mist64/xhyve\">xhyve</a>を使っていて非常にコンパクト。</p>\n<h2>作業環境</h2>\n<ul>\n<li>DLite 1.1.3</li>\n<li>OS X El capitan 10.11.3</li>\n</ul>\n<h2>インストール手順</h2>\n<pre><code>brew install dlite\nsudo dlite install # CPUやディスクサイズなどのオプションは`-h`で確認可能\n</code></pre>\n<p>おしまい。</p>\n<p>内部では以下が行われる:</p>\n<ul>\n<li><code>/etc/sudoers</code>に<code>dlite,nfs</code>コマンドをパスワードなしで<code>sudo</code>できるようにする設定を追加</li>\n<li><code>~/Library/LaunchAgents/local.dlite.plist</code>に起動設定を配置</li>\n<li><code>~/.dlite</code>に起動イメージをダウンロード</li>\n</ul>\n<h2>起動</h2>\n<p>Tmux内で起動しようとするとエラーになるので、必ずTmux外でやること。</p>\n<pre><code>dlite start\n</code></pre>\n<p>問題がなければ以下が加えられる:</p>\n<ul>\n<li><code>/var/run/docker.sock</code> にソケットファイルを作成</li>\n<li><code>/etc/hosts</code> にdliteへの参照を追加 (デフォルトは <code>local.docker</code>。インストール時のオプションで変更可能)</li>\n<li><code>/etc/exports</code> にDLite側のホストへのNFSマウントする設定を追加</li>\n<li><code>~/Library/LaunchAgents/local.dlite.plist</code> をロードし、自動起動するように設定</li>\n</ul>\n<p>うまくいっていれば、<code>docker -H unix://var/run/docker.sock</code>(<code>export DOCKER_HOST=unix:///var/run/docker.sock</code>で指定も可)でdockerが使えるようになる。</p>\n<p>もしうまくいかないようなら、<code>sudo dlite daemon</code>でコマンドラインから実行して原因を突き止める。とくに、NFS周りのコンフリクトが起きていないかを確認。</p>\n<h2>まとめ</h2>\n<p>ホストと仮想環境の間がシームレスにつながってcoLinuxっぽさがある。こういうすっきりしたツールは楽しい。</p>\n<h2>追記</h2>\n<p>2016-05-08: 現在はDocker for Macを利用している。osxfsでファイルシステムのイベントが連携できて便利。</p>\n<h2>参考</h2>\n<ul>\n<li><a href=\"https://github.com/nlf/dlite\">GitHub - nlf/dlite: The simplest way to use Docker on OS X</a></li>\n<li><a href=\"https://blog.andyet.com/2016/01/25/easy-docker-on-osx/\">Simplifying Docker on OS X</a></li>\n</ul>\n"}},"__N_SSG":true}