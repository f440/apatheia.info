{"pageProps":{"post":{"localPath":"/home/f440/go/src/github.com/f440/f440.github.com/content/2013-05-03-create-mesos-rpm-using-fpm.markdown","path":"2013/05/03/create-mesos-rpm-using-fpm","layout":"post","title":"fpm で Mesos の RPM を作るまで","createdAt":"2013-05-03T08:24:00.000Z","kind":"article","comments":true,"tags":["packaging","mesos"],"content":"<p><a href=\"http://incubator.apache.org/mesos/\">Mesos</a> をインストールするとき各マシンでビルドはしんどいので、<a href=\"https://github.com/jordansissel/fpm\">fpm</a> で Mesos の RPM を作ってインストールしている。ビルドからパッケージ作成までの作業ログを残しておく。</p>\n<!-- more -->\n<ul>\n<li><a href=\"https://github.com/jordansissel/fpm\">fpm</a> は Ruby の gem や Node.js の npm などのプログラミング言語のライブラリ、あるいは直接ディレクトリから RPM やら Deb やらのパッケージを作成するソフトウェア。</li>\n<li><a href=\"http://incubator.apache.org/mesos/\">Mesos</a> はクラスタ構成のリソースをよしなに管理するソフトウェア。\n<ul>\n<li>今回の話では具体的な使い方までは触れない</li>\n</ul>\n</li>\n</ul>\n<h2>手順</h2>\n<p>作業環境は CentOS 6.4 x86_64。</p>\n<p>Ruby をインストール。</p>\n<pre><code>sudo yum install ruby.x86_64 rubygems ruby-devel.x86_64 rpm-build.x86_64\n</code></pre>\n<p>fpm をインストール。</p>\n<pre><code>sudo gem install fpm --no-rdoc --no-ri\n</code></pre>\n<p>Mesos のソースをダウンロード、展開。</p>\n<pre><code>curl -LO http://ftp.meisei-u.ac.jp/mirror/apache/dist/incubator/mesos/mesos-0.10.0-incubating/mesos-0.10.0-incubating.tar.gz\ntar xf mesos-0.10.0-incubating.tar.gz\ncd mesos-0.10.0\n</code></pre>\n<p>Mesos のビルドに必要なパッケージをインストール。</p>\n<pre><code>sudo yum install gcc-c++.x86_64 patch.x86_64 python-devel.x86_64 \\\n  cppunit-devel.x86_64 java-1.6.0-openjdk-devel.x86_64\n</code></pre>\n<p>ビルド。今回は、configure のオプションで Redhat っぽい配置を指定している。<code>/opt/mesos</code> とか <code>/usr/local/mesos</code> に全部まとめたければ --prefix を使うなど、このあたりはお好みで。\n<code>make install</code> 時には書き込み可能な場所を DESTDIR で指定。説明中では、<code>/tmp/mesos</code> を利用している。</p>\n<pre><code>JAVA_HOME=/etc/alternatives/java_sdk ./configure \\\n  --bindir=/usr/bin --sbindir=/usr/sbin --libexecdir=/usr/libexec \\\n  --localstatedir=/var --libdir=/usr/lib64 --includedir=/usr/include \\\n  --datarootdir=/usr/share\nmake\nmake install DESTDIR=/tmp/mesos\n</code></pre>\n<p>fpm でパッケージを作成。詳細は fpm --help を参照。注意点としては、<code>--description</code> は RPM のメタ情報 <code>description</code>, <code>summary</code> で兼用されるので、あまり長い情報を入れると <code>yum search</code> とかがごちゃごちゃすることになる。適度に切り詰めた方がいい。</p>\n<pre><code>fpm -s dir -t rpm \\\n  -v 0.10.0 \\\n  -n mesos \\\n  -C /tmp/mesos \\\n  -a x86_64 \\\n  --license \"ASL 2.0\" \\\n  --url \"http://incubator.apache.org/mesos/\" \\\n  --description \"Dynamic resource sharing for clusters\" \\\n  -d python-devel \\\n  -d java-1.6.0-openjdk-devel \\\n  .\n</code></pre>\n<p>RPM ファイルのメタ情報やファイル一覧をチェック。</p>\n<pre><code>rpm -qpi mesos-0.10.0-1.x86_64.rpm\nrpm -qpl mesos-0.10.0-1.x86_64.rpm\n</code></pre>\n<p>あとは、できあがった RPM ファイルを他のマシンに持っていってインストール。</p>\n<pre><code>sudo yum install ./mesos-0.10.0-1.x86_64.rpm\n</code></pre>\n"}},"__N_SSG":true}